---
excerpt: Mixing Data Types
---

## Crossing Rasters with Vectors

Raster and vector geospatial data in R require different packages. 
The creation of geospatial tools in R has been a community effort, and not
necessarily a well-organized one. Development is still ongoing on many packages
dealing with raster and vector data.
One current stumbling block is that the [raster](){:.rlib} package, which is tightly 
integrated with the older [sp](){:.rlib} package, has not fully caught up to the [sf](){:.rlib} package. 
The [stars](https://r-spatial.github.io/stars/) package aims to remedy this problem,
and others, but has not yet released a "version 1.0" (it's at 0.4 as of this
writing). In addition, the [terra](){:.rlib} package, which is better integrated with
[sf](){:.rlib}, may ultimately replace the [raster](){:.rlib} package. It is also still in
development (version 0.6 as of this writing).
{:.notes}

Although not needed in this lesson, you may notice in some cases that it is necessary to
convert a vector object from [sf](){:.rlib} (class beginning with `sfc*`) to [sp](){:.rlib}
(class beginning with `Spatial*`) for the vector object to interact with rasters.
You can do this by calling `sp_object <- as(sf_object, 'Spatial')`.
{:.notes}

The `extract` function allows subsetting and aggregation of raster values based
on a vector spatial object. For example we might want to extract the NLCD land cover 
class at SESYNC's location.

```{r, fig.keep='last', handout = 0}
plot(nlcd)
plot(sesync, col = 'green',
     pch = 16, cex = 2, add = TRUE)
```

===

Pull the coordinates from the `sfc` object containing SESYNC's point location and call `extract`.
When extracting by point locations, the result is a vector of values corresponding to each point. 

```{r, handout = 0}
sesync_lc <- extract(nlcd, st_coordinates(sesync))
```

```{r}
lc_types[sesync_lc + 1]
```

Note that we need to add 1 to correctly match the land cover type name with its numerical
code, because R's numbering starts with 1 but the table starts at 0, as mentioned above.
{:.notes}

===

When extracting with a polygon, the output is a vector of all raster values for
pixels falling within that polygon. This code extracts all pixels within the first
polygon in the Maryland county data frame.

```{r, handout = 0, warning = FALSE}
county_nlcd <- extract(nlcd_agg,
    counties_md[1,])
```

```{r}
table(county_nlcd)
```

===

To get a summary of raster values for **each** polygon in an `sfc`
object, add an aggregation function to `extract` via the `fun` argument. For
example, `fun = modal` gives the most common land cover type for each polygon in
`huc_md`.

```{r, handout = 0, warning = FALSE}
modal_lc <- extract(nlcd_agg,
    huc_md, fun = modal)
huc_md <- huc_md %>%
  mutate(modal_lc = lc_types[modal_lc + 1])
```

```{r}
huc_md
```
