---
excerpt: Mixing Data Types
---

## Crossing Rasters with Vectors

Raster and vector geospatial data in R require different packages. 
The creation of geospatial tools in R has been a community effort, and not
necessarily a well-organized one. Development is still ongoing on many packages
dealing with raster and vector data. The recent release of [terra](){:.rlib} and
[stars](){:.rlib} means that raster packages are now integrated with [sf](){:.rlib}.
The older [raster](){:.rlib} package was integrated with the older vector package
[sp](){:.rlib}. However [stars](){:.rlib} has not yet released a "version 1.0" 
(it's at 0.5-2 as of this writing). 
{:.notes}

Although not needed in this lesson, you may notice in some cases that it is necessary to
convert a vector object from [sf](){:.rlib} (class beginning with `sfc*`) to [sp](){:.rlib}
(class beginning with `Spatial*`) for the vector object to interact with rasters from the
older [raster](){:.rlib} package.
You can do this by calling `sp_object <- as(sf_object, 'Spatial')`.
{:.notes}

The `extract` function allows subsetting and aggregation of raster values based
on a vector spatial object. For example we might want to extract the NLCD land cover 
class at SESYNC's location.

```{r, fig.keep='last', handout = 0}
plot(nlcd)
plot(sesync, col = 'green',
     pch = 16, cex = 2, add = TRUE)
```

===

Pull the coordinates from the `sfc` object containing SESYNC's point location and call `extract`.
When extracting by point locations, the result is a vector of values corresponding to each point. 

```{r, handout = 0}
sesync_lc <- extract(nlcd, st_coordinates(sesync))
```

```{r}
sesync_lc
```

===

When extracting with a polygon, the output is a vector of all raster values for
pixels falling within that polygon. This code extracts all pixels within the first
polygon in the Maryland county data frame.
**NOTE FIXME FIXME FIXME THE TERRA PKG DOES NOT YET SUPPORT EXTRACT FROM SF. SO WE WILL HOLD OFF ON UPDATING THIS FURTHER TILL IT DOES.**

```{r, handout = 0, warning = FALSE}
county_nlcd <- extract(nlcd_agg,
    counties_md[1,])
```

```{r}
table(county_nlcd)
```

===

To get a summary of raster values for **each** polygon in an `sfc`
object, add an aggregation function to `extract` via the `fun` argument. For
example, `fun = modal` gives the most common land cover type for each polygon in
`huc_md`.

```{r, handout = 0, warning = FALSE}
modal_lc <- extract(nlcd_agg,
    huc_md, fun = modal)
huc_md <- huc_md %>%
  mutate(modal_lc = lc_types[modal_lc + 1])
```

```{r}
huc_md
```
