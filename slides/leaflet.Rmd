---
---

## Interactive Maps

The [leaflet](){:.rlib} package is an R interface to the leaflet JavaScript
library. It produces interactive maps (with controls to zoom, pan and toggle
layers) combining local data with base layers from web mapping services.

===

The `leaflet()` function creates an empty leaflet map to which layers can be
added using the pipe (`%>%`) operator. The `addTiles` functions adds a base
tiled map; by default, it imports tiles from OpenStreetMap. We center and zoom
the map with `setView`.

```{r, handout = 0}
library(leaflet)
leaflet() %>%
    addTiles() %>%
    setView(lng = -77, lat = 39, 
        zoom = 7)
```

The map shows up in the "Viewer" tab in RStudio because, like everything with
JavaScript, it relies on your browser to render the image.
{:.notes}

===

Spatial datasets (points, lines, polygons, rasters) in your R environment can
also be added as map layers, provided they are in lat/lon coordinates. Leaflet
will try to make the necessary transformation to display your data in
[EPSG:3857](https://epsg.io/3857).

```{r, handout = 0}
leaflet() %>%
    addTiles() %>%
    addPolygons(
        data = st_transform(huc_md, 4326)) %>%
    setView(lng = -77, lat = 39, 
        zoom = 7)
```

===

Leaflet can access open data from various web mapping services
(WMS), including real-time weather radar data from the [Iowa Environmental
Mesonet](https://mesonet.agron.iastate.edu/ogc/).

```{r, handout = 0}
leaflet() %>%
    addTiles() %>%
    addWMSTiles(
        "http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi",
        layers = "nexrad-n0r-900913", group = "base_reflect",
        options = WMSTileOptions(format = "image/png", transparent = TRUE),
        attribution = "Weather data Â© 2012 IEM Nexrad") %>%
    setView(lng = -77, lat = 39, 
        zoom = 7)
```

Use the map controls to zoom away from the current location and find ongoing
storm events.
